(function($){var u=$.fn.jquery.split('.'),_jQuery14OrLower=(10*u[0]+u[1])<15;$.widget('ui.weekCalendar',(function(){var t;return{options:{date:new Date(),timeFormat:'h:i a',dateFormat:'M d, Y',alwaysDisplayTimeMinutes:true,use24Hour:false,daysToShow:7,minBodyHeight:100,firstDayOfWeek:function(a){if($(a).weekCalendar('option','daysToShow')!=5){return 0}else{return 1}},useShortDayNames:false,timeSeparator:' to ',startParam:'start',endParam:'end',businessHours:{start:8,end:18,limitDisplay:false},newEventText:'New Event',timeslotHeight:20,defaultEventLength:2,timeslotsPerHour:4,minDate:null,maxDate:null,buttons:true,buttonText:{today:'today',lastWeek:'previous',nextWeek:'next'},switchDisplay:{},scrollToHourMillis:500,allowCalEventOverlap:false,overlapEventsSeparate:false,readonly:false,allowEventCreation:true,draggable:function(a,b){return true},resizable:function(a,b){return true},eventClick:function(a,b,c,d,e){},eventRender:function(a,b){return b},eventAfterRender:function(a,b){return b},eventRefresh:function(a,b){return b},eventDrag:function(a,b){},eventDrop:function(a,b){},eventResize:function(a,b){},eventNew:function(a,b,c,d,e){},eventMouseover:function(a,b){},eventMouseout:function(a,b){},calendarBeforeLoad:function(a){},calendarAfterLoad:function(a){},noEvents:function(){},eventHeader:function(a,b){var c=b.weekCalendar('option');var d=3600000;var e=a.end.getTime()-a.start.getTime()<=(d/c.timeslotsPerHour);if(e){return b.weekCalendar('formatDate',a.start,c.timeFormat)+': '+a.title}else{return b.weekCalendar('formatDate',a.start,c.timeFormat)+c.timeSeparator+b.weekCalendar('formatDate',a.end,c.timeFormat)}},eventBody:function(a,b){return a.title},shortMonths:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],longMonths:['January','February','March','April','May','June','July','August','September','October','November','December'],shortDays:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],longDays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],users:[],showAsSeparateUsers:true,getUserId:function(a,b,c){return b},getUserName:function(a,b,c){return a},getEventUserId:function(a,b){return a.userId},setEventUserId:function(a,b,c){b.userId=a;return b},displayFreeBusys:false,getFreeBusyUserId:function(a,b){return a.userId},defaultFreeBusy:{free:false},freeBusyRender:function(a,b,c){if(!a.free){b.addClass('free-busy-busy')}else{b.addClass('free-busy-free')}return b},startOnFirstDayOfWeek:function(a){return $(a).weekCalendar('option','daysToShow')>=5},displayOddEven:false,textSize:13,title:'%start% - %end%',jsonOptions:{},headerSeparator:'<br />',getHeaderDate:null,preventDragOnEventCreation:false,resizeEvent:'resize.weekcalendar'},_create:function(){var a=this;a._computeOptions();a._setupEventDelegation();a._renderCalendar();a._loadCalEvents();a._resizeCalendar();a._scrollToHour(a.options.date.getHours(),true);if(this.options.resizeEvent){$(window).unbind(this.options.resizeEvent);$(window).bind(this.options.resizeEvent,function(){a._resizeCalendar()})}},refresh:function(){this._loadCalEvents(this.element.data('startDate'))},clear:function(){this._clearCalendar()},today:function(){this._clearCalendar();this._loadCalEvents(new Date())},prevWeek:function(){var a=new Date(this.element.data('startDate').getTime()-(w/6));this._clearCalendar();this._loadCalEvents(a)},nextWeek:function(){var a=new Date(this.element.data('startDate').getTime()+w+v);this._clearCalendar();this._loadCalEvents(a)},gotoWeek:function(a){this._clearCalendar();this._loadCalEvents(a)},gotoDate:function(a){this._clearCalendar();this._loadCalEvents(a)},setDaysToShow:function(a){var b=this;var c=b._getCurrentScrollHour();b.options.daysToShow=a;$(b.element).html('');b._renderCalendar();b._loadCalEvents();b._resizeCalendar();b._scrollToHour(c,false);if(this.options.resizeEvent){$(window).unbind(this.options.resizeEvent);$(window).bind(this.options.resizeEvent,function(){b._resizeCalendar()})}},removeEvent:function(a){var b=this;b.element.find('.wc-cal-event').each(function(){if($(this).data('calEvent').id===a){$(this).remove();return false}});b.element.find('.wc-day-column-inner').each(function(){b._adjustOverlappingEvents($(this))})},removeUnsavedEvents:function(){var a=this;a.element.find('.wc-new-cal-event').each(function(){$(this).remove()});a.element.find('.wc-day-column-inner').each(function(){a._adjustOverlappingEvents($(this))})},updateEvent:function(a){this._updateEventInCalendar(a)},getTimeslotTimes:function(a){var b=this.options;var c=b.businessHours.limitDisplay?b.businessHours.start:0;var d=new Date(a.getFullYear(),a.getMonth(),a.getDate(),c);var e=[],startMillis=d.getTime();for(var i=0;i<b.timeslotsPerDay;i++){var f=startMillis+b.millisPerTimeslot;e[i]={start:new Date(startMillis),startFormatted:this._formatDate(new Date(startMillis),b.timeFormat),end:new Date(f),endFormatted:this._formatDate(new Date(f),b.timeFormat)};startMillis=f}return e},formatDate:function(a,b){if(b){return this._formatDate(a,b)}else{return this._formatDate(a,this.options.dateFormat)}},formatTime:function(a,b){if(b){return this._formatDate(a,b)}else{return this._formatDate(a,this.options.timeFormat)}},serializeEvents:function(){var a=this;var b=[];a.element.find('.wc-cal-event').each(function(){b.push($(this).data('calEvent'))});return b},next:function(){if(this._startOnFirstDayOfWeek()){return this.nextWeek()}var a=new Date(this.element.data('startDate').getTime());a.setDate(a.getDate()+this.options.daysToShow);this._clearCalendar();this._loadCalEvents(a)},prev:function(){if(this._startOnFirstDayOfWeek()){return this.prevWeek()}var a=new Date(this.element.data('startDate').getTime());a.setDate(a.getDate()-this.options.daysToShow);this._clearCalendar();this._loadCalEvents(a)},getCurrentFirstDay:function(){return this._dateFirstDayOfWeek(this.options.date||new Date())},getCurrentLastDay:function(){return this._addDays(this.getCurrentFirstDay(),this.options.daysToShow-1)},_setOption:function(a,b){var c=this;if(c.options[a]!=b){var d=$.map(c.element.find('.wc-cal-event'),function(){return $(this).data('calEvent')});var e={};e[a]=b;c._renderEvents({events:d,options:e},c.element.find('.wc-day-column-inner'))}},_computeOptions:function(){var a=this.options;if(a.businessHours.limitDisplay){a.timeslotsPerDay=a.timeslotsPerHour*(a.businessHours.end-a.businessHours.start);a.millisToDisplay=(a.businessHours.end-a.businessHours.start)*3600000;a.millisPerTimeslot=a.millisToDisplay/a.timeslotsPerDay}else{a.timeslotsPerDay=a.timeslotsPerHour*24;a.millisToDisplay=v;a.millisPerTimeslot=v/a.timeslotsPerDay}},_resizeCalendar:function(){var a=this.options;if(a&&$.isFunction(a.height)){var b=a.height(this.element);var c=this.element.find('.wc-header').outerHeight();var d=this.element.find('.wc-toolbar').outerHeight();var e=Math.max(b-d-c,a.minBodyHeight);var f=this.element.find('.wc-time-slots').outerHeight();this.element.find('.wc-scrollable-grid').height(e);if(f<=e){this.element.find('.wc-scrollbar-shim').width(0)}else{this.element.find('.wc-scrollbar-shim').width(this._findScrollBarWidth())}this._trigger('resize',this.element)}},_findScrollBarWidth:function(){var a=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo('body');var b=a.children();var c=b.innerWidth()-b.height(99).innerWidth();a.remove();return c||16},_setupEventDelegation:function(){var d=this;var e=this.options;this.element.click(function(a){var b=$(a.target),freeBusyManager;if(b.data('preventClick')){return}var c=b.hasClass('wc-cal-event')?b:b.parents('.wc-cal-event');if(c.length){freeBusyManager=d.getFreeBusyManagerForEvent(c.data('calEvent'));e.eventClick(c.data('calEvent'),c,freeBusyManager,d.element,a)}}).mouseover(function(a){var b=$(a.target);if(d._isDraggingOrResizing(b)){return}if(b.hasClass('wc-cal-event')){e.eventMouseover(b.data('calEvent'),b,a)}}).mouseout(function(a){var b=$(a.target);if(d._isDraggingOrResizing(b)){return}if(b.hasClass('wc-cal-event')){if(b.data('sizing')){return}e.eventMouseout(b.data('calEvent'),b,a)}})},_isDraggingOrResizing:function(a){return a.hasClass('ui-draggable-dragging')||a.hasClass('ui-resizable-resizing')},_renderCalendar:function(){var b,$weekDayColumns;var c=this;var d=this.options;b=$('<div class=\"ui-widget wc-container\">').appendTo(c.element);c._renderCalendarButtons(b);c._renderCalendarHeader(b);c._renderCalendarBody(b);$weekDayColumns=b.find('.wc-day-column-inner');$weekDayColumns.each(function(i,a){if(!d.readonly){c._addDroppableToWeekDay($(this));if(d.allowEventCreation){c._setupEventCreationForWeekDay($(this))}}})},_renderCalendarButtons:function(f){var g=this,options=this.options;if(options.buttons){var h='';h+='<div class=\"ui-widget-header wc-toolbar\">';h+='<div class=\"wc-display\"></div>';h+='<div class=\"wc-nav\">';h+='<button class=\"wc-prev\">'+options.buttonText.lastWeek+'</button>';h+='<button class=\"wc-today\">'+options.buttonText.today+'</button>';h+='<button class=\"wc-next\">'+options.buttonText.nextWeek+'</button>';h+='</div>';h+='<p class=\"wc-title\"></p>';h+='</div>';$(h).appendTo(f);f.find('.wc-nav .wc-today').button({icons:{primary:'ui-icon-home'}}).click(function(){g.today();return false});f.find('.wc-nav .wc-prev').button({text:false,icons:{primary:'ui-icon-seek-prev'}}).click(function(){g.element.weekCalendar('prev');return false});f.find('.wc-nav .wc-next').button({text:false,icons:{primary:'ui-icon-seek-next'}}).click(function(){g.element.weekCalendar('next');return false});if(this.options.switchDisplay&&$.isPlainObject(this.options.switchDisplay)){var i=f.find('.wc-display');$.each(this.options.switchDisplay,function(a,b){var c='wc-switch-display-'+b;var d=$('<input type="radio" id="'+c+'" name="wc-switch-display" class="wc-switch-display"/>');var e=$('<label for="'+c+'"></label>');e.html(a);d.val(b);if(parseInt(g.options.daysToShow,10)===parseInt(b,10)){d.attr('checked','checked')}i.append(d).append(e)});i.find('input').change(function(){g.setDaysToShow(parseInt($(this).val(),10))})}f.find('.wc-nav, .wc-display').buttonset();var j=f.find('.wc-nav').outerHeight();f.find('.wc-title').height(j).css('line-height',j+'px')}},_renderCalendarHeader:function(a){var b=this,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,rowspan='',colspan='',calendarHeaderHtml;if(showAsSeparatedUser){rowspan=' rowspan=\"2\"';colspan=' colspan=\"'+options.users.length+'\" '}calendarHeaderHtml='<div class=\"ui-widget-content wc-header\">';calendarHeaderHtml+='<table><tbody><tr><td class=\"wc-time-column-header\"></td>';for(var i=1;i<=options.daysToShow;i++){calendarHeaderHtml+='<td class=\"wc-day-column-header wc-day-'+i+'\"'+colspan+'></td>'}calendarHeaderHtml+='<td class=\"wc-scrollbar-shim\"'+rowspan+'></td></tr>';if(showAsSeparatedUser){calendarHeaderHtml+='<tr><td class=\"wc-time-column-header\"></td>';var c=options.users.length,_headerClass='';for(var i=1;i<=options.daysToShow;i++){for(var j=0;j<c;j++){_headerClass=[];if(j==0){_headerClass.push('wc-day-column-first')}if(j==c-1){_headerClass.push('wc-day-column-last')}if(!_headerClass.length){_headerClass='wc-day-column-middle'}else{_headerClass=_headerClass.join(' ')}calendarHeaderHtml+='<td class=\"'+_headerClass+' wc-user-header wc-day-'+i+' wc-user-'+b._getUserIdFromIndex(j)+'\">';calendarHeaderHtml+=b._getUserName(j);calendarHeaderHtml+='</td>'}}calendarHeaderHtml+='</tr>'}calendarHeaderHtml+='</tbody></table></div>';$(calendarHeaderHtml).appendTo(a)},_renderCalendarBody:function(a){var b=this,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,$calendarBody,$calendarTableTbody;$calendarBody='<div class=\"wc-scrollable-grid\">';$calendarBody+='<table class=\"wc-time-slots\">';$calendarBody+='<tbody>';$calendarBody+='</tbody>';$calendarBody+='</table>';$calendarBody+='</div>';$calendarBody=$($calendarBody);$calendarTableTbody=$calendarBody.find('tbody');b._renderCalendarBodyTimeSlots($calendarTableTbody);b._renderCalendarBodyOddEven($calendarTableTbody);b._renderCalendarBodyFreeBusy($calendarTableTbody);b._renderCalendarBodyEvents($calendarTableTbody);$calendarBody.appendTo(a);a.find('.wc-full-height-column').height(options.timeslotHeight*options.timeslotsPerDay);a.find('.wc-time-slot').height(options.timeslotHeight-1);a.find('.wc-time-header-cell').css({height:(options.timeslotHeight*options.timeslotsPerHour)-11,padding:5});if(showAsSeparatedUser){for(var i=0,uLength=options.users.length;i<uLength;i++){a.find('.wc-user-'+b._getUserIdFromIndex(i)).data('wcUser',options.users[i]).data('wcUserIndex',i).data('wcUserId',b._getUserIdFromIndex(i))}}},_renderCalendarBodyTimeSlots:function(a){var b=this.options,renderRow,i,j,showAsSeparatedUser=b.showAsSeparateUsers&&b.users&&b.users.length,start=(b.businessHours.limitDisplay?b.businessHours.start:0),end=(b.businessHours.limitDisplay?b.businessHours.end:24),rowspan=1;if(b.displayOddEven){rowspan+=1}if(b.displayFreeBusys){rowspan+=1}if(rowspan>1){rowspan=' rowspan=\"'+rowspan+'\"'}else{rowspan=''}renderRow='<tr class=\"wc-grid-row-timeslot\">';renderRow+='<td class=\"wc-grid-timeslot-header\"'+rowspan+'></td>';renderRow+='<td colspan=\"'+b.daysToShow*(showAsSeparatedUser?b.users.length:1)+'\">';renderRow+='<div class=\"wc-no-height-wrapper wc-time-slot-wrapper\">';renderRow+='<div class=\"wc-time-slots\">';for(i=start;i<end;i++){for(j=0;j<b.timeslotsPerHour-1;j++){renderRow+='<div class=\"wc-time-slot\"></div>'}renderRow+='<div class=\"wc-time-slot wc-hour-end\"></div>'}renderRow+='</div>';renderRow+='</div>';renderRow+='</td>';renderRow+='</tr>';$(renderRow).appendTo(a)},_renderCalendarBodyOddEven:function(a){if(this.options.displayOddEven){var b=this.options,renderRow='<tr class=\"wc-grid-row-oddeven\">',showAsSeparatedUser=b.showAsSeparateUsers&&b.users&&b.users.length,oddEven,oddEvenClasses={'odd':'wc-column-odd','even':'ui-state-hover wc-column-even'};for(var i=1;i<=b.daysToShow;i++){if(b.displayOddEven){if(!showAsSeparatedUser){oddEven=(oddEven=='odd'?'even':'odd');renderRow+='<td class=\"wc-day-column day-'+i+'\">';renderRow+='<div class=\"wc-no-height-wrapper wc-oddeven-wrapper\">';renderRow+='<div class=\"wc-full-height-column '+oddEvenClasses[oddEven]+'\"></div>';renderRow+='</div>';renderRow+='</td>'}else{var c=b.users.length;for(var j=0;j<c;j++){oddEven=(oddEven=='odd'?'even':'odd');renderRow+='<td class=\"wc-day-column day-'+i+'\">';renderRow+='<div class=\"wc-no-height-wrapper wc-oddeven-wrapper\">';renderRow+='<div class=\"wc-full-height-column '+oddEvenClasses[oddEven]+'\" ></div>';renderRow+='</div>';renderRow+='</td>'}}}}renderRow+='</tr>';$(renderRow).appendTo(a)}},_renderCalendarBodyFreeBusy:function(a){if(this.options.displayFreeBusys){var b=this,options=this.options,renderRow='<tr class=\"wc-grid-row-freebusy\">',showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length;renderRow+='</td>';for(var i=1;i<=options.daysToShow;i++){if(options.displayFreeBusys){if(!showAsSeparatedUser){renderRow+='<td class=\"wc-day-column day-'+i+'\">';renderRow+='<div class=\"wc-no-height-wrapper wc-freebusy-wrapper\">';renderRow+='<div class=\"wc-full-height-column wc-column-freebusy wc-day-'+i+'\"></div>';renderRow+='</div>';renderRow+='</td>'}else{var c=options.users.length;for(var j=0;j<c;j++){renderRow+='<td class=\"wc-day-column day-'+i+'\">';renderRow+='<div class=\"wc-no-height-wrapper wc-freebusy-wrapper\">';renderRow+='<div class=\"wc-full-height-column wc-column-freebusy wc-day-'+i;renderRow+=' wc-user-'+b._getUserIdFromIndex(j)+'\">';renderRow+='</div>';renderRow+='</div>';renderRow+='</td>'}}}}renderRow+='</tr>';$(renderRow).appendTo(a)}},_renderCalendarBodyEvents:function(a){var b=this,options=this.options,renderRow,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,start=(options.businessHours.limitDisplay?options.businessHours.start:0),end=(options.businessHours.limitDisplay?options.businessHours.end:24);renderRow='<tr class=\"wc-grid-row-events\">';renderRow+='<td class=\"wc-grid-timeslot-header\">';for(var i=start;i<end;i++){var c=(options.businessHours.start<=i&&options.businessHours.end>i)?'ui-state-active wc-business-hours':'ui-state-default';renderRow+='<div class=\"wc-hour-header '+c+'\">';if(options.use24Hour){renderRow+='<div class=\"wc-time-header-cell\">'+b._24HourForIndex(i)+'</div>'}else{renderRow+='<div class=\"wc-time-header-cell\">'+b._hourForIndex(i)+'<span class=\"wc-am-pm\">'+b._amOrPm(i)+'</span></div>'}renderRow+='</div>'}renderRow+='</td>';var d='ui-state-default wc-day-column';for(var i=1;i<=options.daysToShow;i++){if(!showAsSeparatedUser){renderRow+='<td class=\"'+d+' wc-day-column-first wc-day-column-last day-'+i+'\">';renderRow+='<div class=\"wc-full-height-column wc-day-column-inner day-'+i+'\"></div>';renderRow+='</td>'}else{var e=options.users.length;var f;for(var j=0;j<e;j++){f=[];if(j==0){f.push('wc-day-column-first')}if(j==e-1){f.push('wc-day-column-last')}if(!f.length){f='wc-day-column-middle'}else{f=f.join(' ')}renderRow+='<td class=\"'+d+' '+f+' day-'+i+'\">';renderRow+='<div class=\"wc-full-height-column wc-day-column-inner day-'+i;renderRow+=' wc-user-'+b._getUserIdFromIndex(j)+'\">';renderRow+='</div>';renderRow+='</td>'}}}renderRow+='</tr>';$(renderRow).appendTo(a)},_setupEventCreationForWeekDay:function(l){var m=this;var n=this.options;l.mousedown(function(e){var f=$(e.target);if(f.hasClass('wc-day-column-inner')){var g=$('<div class=\"wc-cal-event wc-new-cal-event wc-new-cal-event-creating\"></div>');g.css({lineHeight:(n.timeslotHeight-2)+'px',fontSize:(n.timeslotHeight/2)+'px'});f.append(g);var h=f.offset().top;var i=e.pageY-h;var j=(i-(i%n.timeslotHeight))/n.timeslotHeight;var k=j*n.timeslotHeight;g.css({top:k});if(!n.preventDragOnEventCreation){f.bind('mousemove.newevent',function(a){g.show();g.addClass('ui-resizable-resizing');var b=Math.round(a.pageY-h-k);var c=b%n.timeslotHeight;if(c<0){var d=b-c;g.css('height',d<n.timeslotHeight?n.timeslotHeight:d)}else{g.css('height',b+(n.timeslotHeight-c))}}).mouseup(function(){f.unbind('mousemove.newevent');g.addClass('ui-corner-all')})}}}).mouseup(function(a){var b=$(a.target);var c=b.closest('.wc-day-column-inner');var d=c.find('.wc-new-cal-event-creating');if(d.length){if(!d.hasClass('ui-resizable-resizing')){d.css({height:n.timeslotHeight*n.defaultEventLength}).show()}var e=parseInt(d.css('top'));var f=m._getEventDurationFromPositionedEventElement(c,d,e);d.remove();var g={start:f.start,end:f.end,title:n.newEventText};var h=n.showAsSeparateUsers&&n.users&&n.users.length;if(h){g=m._setEventUserId(g,c.data('wcUserId'))}else if(!n.showAsSeparateUsers&&n.users&&n.users.length==1){g=m._setEventUserId(g,m._getUserIdFromIndex(0))}var i=m.getFreeBusyManagerForEvent(g);var j=m._renderEvent(g,c);if(!n.allowCalEventOverlap){m._adjustForEventCollisions(c,j,g,g);m._positionEvent(c,j)}else{m._adjustOverlappingEvents(c)}n.eventNew(g,j,i,m.element,a)}})},_loadCalEvents:function(d){var e,weekStartDate,weekEndDate,$weekDayColumns;var f=this;var g=this.options;e=this._fixMinMaxDate(d||g.date);if((!e||!e.getTime)||(!g.date||!g.date.getTime)||e.getTime()!=g.date.getTime()){this._trigger('changedate',this.element,e)}this.options.date=e;weekStartDate=f._dateFirstDayOfWeek(e);weekEndDate=f._dateLastMilliOfWeek(e);g.calendarBeforeLoad(f.element);f.element.data('startDate',weekStartDate);f.element.data('endDate',weekEndDate);$weekDayColumns=f.element.find('.wc-day-column-inner');f._updateDayColumnHeader($weekDayColumns);if(typeof g.data=='string'){if(g.loading){g.loading(true)}if(t){if(!_jQuery14OrLower){t.abort()}else{t.onreadystatechange=null;t.abort();t=null;if(g.loading){g.loading(false)}}}var h=f._getJsonOptions();h[g.startParam||'start']=Math.round(weekStartDate.getTime()/1000);h[g.endParam||'end']=Math.round(weekEndDate.getTime()/1000);t=$.ajax({url:g.data,data:h,dataType:'json',error:function(a,b,c){if(c!='abort'){alert('unable to get data, error:'+b)}},success:function(a){f._renderEvents(a,$weekDayColumns)},complete:function(){t=null;if(g.loading){g.loading(false)}}})}else if($.isFunction(g.data)){g.data(weekStartDate,weekEndDate,function(a){f._renderEvents(a,$weekDayColumns)})}else if(g.data){f._renderEvents(g.data,$weekDayColumns)}f._disableTextSelect($weekDayColumns)},_updateDayColumnHeader:function(b){var c=this;var d=this.options;var e=c._cloneDate(c.element.data('startDate'));var f=d.showAsSeparateUsers&&d.users&&d.users.length;var g='ui-state-active wc-today';c.element.find('.wc-header td.wc-day-column-header').each(function(i,a){$(this).html(c._getHeaderDate(e));if(c._isToday(e)){$(this).addClass(g)}else{$(this).removeClass(g)}e=c._addDays(e,1)});e=c._cloneDate(c.element.data('startDate'));if(f){c.element.find('.wc-header td.wc-user-header').each(function(i,a){if(c._isToday(e)){$(this).addClass(g)}else{$(this).removeClass(g)}e=((i+1)%d.users.length)?e:c._addDays(e,1)})}e=c._cloneDate(c.element.data('startDate'));b.each(function(i,a){$(this).data('startDate',c._cloneDate(e));$(this).data('endDate',new Date(e.getTime()+(v)));if(c._isToday(e)){$(this).parent().addClass(g).removeClass('ui-state-default')}else{$(this).parent().removeClass(g).addClass('ui-state-default')}if(!f||!((i+1)%d.users.length)){e=c._addDays(e,1)}});if(d.displayFreeBusys){e=c._cloneDate(c.element.data('startDate'));c.element.find('.wc-grid-row-freebusy .wc-column-freebusy').each(function(i,a){$(this).data('startDate',c._cloneDate(e));$(this).data('endDate',new Date(e.getTime()+(v)));if(!f||!((i+1)%d.users.length)){e=c._addDays(e,1)}})}if(this.options.title&&this.options.title.length){var h=this.options.date,_start=c._cloneDate(c.element.data('startDate')),_end=c._dateLastDayOfWeek(new Date(this._cloneDate(c.element.data('endDate')).getTime()-(v))),_title=this._getCalendarTitle();_title=_title.split('%start%').join(c._formatDate(_start,d.dateFormat));_title=_title.split('%end%').join(c._formatDate(_end,d.dateFormat));_title=_title.split('%date%').join(c._formatDate(h,d.dateFormat));$('.wc-toolbar .wc-title',c.element).html(_title)}},_getCalendarTitle:function(){if($.isFunction(this.options.title)){return this.options.title(this.options.daysToShow)}return this.options.title},_renderEvents:function(k,l){var m=this;var n=this.options;var o;if(k.options){var p=false;$.each(k.options,function(a,b){if(b!==n[a]){n[a]=b;p=p||$.ui.weekCalendar.updateLayoutOptions[a]}});m._computeOptions();if(p){var q=m._getCurrentScrollHour();m.element.empty();m._renderCalendar();l=m.element.find('.wc-time-slots .wc-day-column-inner');m._updateDayColumnHeader(l);m._resizeCalendar();m._scrollToHour(q,false)}}this._clearCalendar();if($.isArray(k)){o=m._cleanEvents(k)}else if(k.events){o=m._cleanEvents(k.events);m._renderFreeBusys(k)}$.each(o,function(i,a){var b=new Date(a.start);var c=new Date(a.end);var d=m.options.businessHours.limitDisplay?m.options.businessHours.end:24;var e=m.options.businessHours.limitDisplay?m.options.businessHours.start:0;var f=new Date(b);var g=c.getDay();var h;var j=false;while(f.getDay()<g){a.start=f;a.end.setFullYear(f.getFullYear());a.end.setMonth(f.getMonth());a.end.setDate(f.getDate());a.end.setHours(d);a.end.setMinutes(0);a.end.setSeconds(0);if((h=m._findWeekDayForEvent(a,l))){m._renderEvent(a,h)}f.setDate(f.getDate()+1);f.setHours(e);f.setMinutes(0);f.setSeconds(0);j=true}if(f<=c){a.start=f;a.end=c;if(((j&&a.start.getTime()!=a.end.getTime())||!j)&&(h=m._findWeekDayForEvent(a,l))){m._renderEvent(a,h)}}a.start=b});l.each(function(){m._adjustOverlappingEvents($(this))});n.calendarAfterLoad(m.element);if(!o.length){n.noEvents()}},_renderEvent:function(b,c){var d=this;var e=this.options;if(b.start.getTime()>b.end.getTime()){return}var f,eventHtml,$calEventList,$modifiedEvent;f=b.id?'wc-cal-event':'wc-cal-event wc-new-cal-event';eventHtml='<div class=\"'+f+' ui-corner-all\">';eventHtml+='<div class=\"wc-time ui-corner-top\"></div>';eventHtml+='<div class=\"wc-title\"></div></div>';c.each(function(){var a=$(eventHtml);$modifiedEvent=e.eventRender(b,a);a=$modifiedEvent?$modifiedEvent.appendTo($(this)):a.appendTo($(this));a.css({lineHeight:(e.textSize+2)+'px',fontSize:e.textSize+'px'});d._refreshEventDetails(b,a);d._positionEvent($(this),a);if($calEventList){$calEventList=$calEventList.add(a)}else{$calEventList=a}});$calEventList.show();if(!e.readonly&&e.resizable(b,$calEventList)){d._addResizableToCalEvent(b,$calEventList,c)}if(!e.readonly&&e.draggable(b,$calEventList)){d._addDraggableToCalEvent(b,$calEventList)}e.eventAfterRender(b,$calEventList);return $calEventList},addEvent:function(){return this._renderEvent.apply(this,arguments)},_adjustOverlappingEvents:function(g){var h=this;if(h.options.allowCalEventOverlap){var i=h._groupOverlappingEventElements(g);$.each(i,function(){var f=this;$.each(f,function(b){var c=this;if(h.options.overlapEventsSeparate){var d=100/f.length;var e=b*d}else{var d=100-((f.length-1)*10);var e=b*10}$.each(c,function(){if(!h.options.overlapEventsSeparate){$(this).bind('mouseover.z-index',function(){var a=$(this);$.each(c,function(){$(this).css({'z-index':'1'})});a.css({'z-index':'3'})})}$(this).css({width:d+'%',left:e+'%',right:0})})})})}},_groupOverlappingEventElements:function(c){var d=c.find('.wc-cal-event:visible');var e=d.sort(function(a,b){return $(a).data('calEvent').start.getTime()-$(b).data('calEvent').start.getTime()});var f=new Date(0,0,0);var g=[];var h=[];var i;$.each(e,function(){i=$(this);if(h.length>0){if(f.getTime()<=i.data('calEvent').start.getTime()){g.push(h);h=[]}}for(var a=0;a<h.length;a++){if(h[a].length>0){if(h[a][h[a].length-1].data('calEvent').end.getTime()<=i.data('calEvent').start.getTime()){h[a].push(i);if(f.getTime()<i.data('calEvent').end.getTime()){f=i.data('calEvent').end}return}}}h.push([i]);if(f.getTime()<i.data('calEvent').end.getTime()){f=i.data('calEvent').end}});if(h.length>0){g.push(h)}return g},_findWeekDayForEvent:function(c,d){var e,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,user_ids=this._getEventUserId(c);if(!$.isArray(user_ids)){user_ids=[user_ids]}d.each(function(a,b){if($(this).data('startDate').getTime()<=c.start.getTime()&&$(this).data('endDate').getTime()>=c.end.getTime()&&(!showAsSeparatedUser||$.inArray($(this).data('wcUserId'),user_ids)!==-1)){if(e){e=e.add($(b))}else{e=$(b)}}});return e},_updateEventInCalendar:function(e){var f=this;f._cleanEvent(e);if(e.id){f.element.find('.wc-cal-event').each(function(){if($(this).data('calEvent').id===e.id||$(this).hasClass('wc-new-cal-event')){$(this).remove()}})}var g=f._findWeekDayForEvent(e,f.element.find('.wc-grid-row-events .wc-day-column-inner'));if(g){g.each(function(a,b){var c=$(b);var d=f._renderEvent(e,c);f._adjustForEventCollisions(c,d,e,e);f._refreshEventDetails(e,d);f._positionEvent(c,d);f._adjustOverlappingEvents(c)})}},_positionEvent:function(a,b){var c=this.options;var d=b.data('calEvent');var e=a.height()/c.millisToDisplay;var f=c.businessHours.limitDisplay?c.businessHours.start:0;var g=this._getDSTdayShift(d.start).getTime()-this._getDSTdayShift(new Date(d.start.getFullYear(),d.start.getMonth(),d.start.getDate(),f)).getTime();var h=this._getDSTdayShift(d.end).getTime()-this._getDSTdayShift(d.start).getTime();var i=e*g;var j=e*h;b.css({top:i,height:j||(e*3600000/c.timeslotsPerHour)})},_getEventDurationFromPositionedEventElement:function(a,b,c){var d=this.options;var e=d.businessHours.limitDisplay?d.businessHours.start*3600000:0;var f=new Date(a.data('startDate').getTime()+e+Math.round(c/d.timeslotHeight)*d.millisPerTimeslot);var g=new Date(f.getTime()+(b.height()/d.timeslotHeight)*d.millisPerTimeslot);return{start:this._getDSTdayShift(f,-1),end:this._getDSTdayShift(g,-1)}},_adjustForEventCollisions:function(b,c,d,e,f){var g=this.options;if(g.allowCalEventOverlap){return}var h,adjustedEnd;var i=this;b.find('.wc-cal-event').not(c).each(function(){var a=$(this).data('calEvent');if(d.start.getTime()<a.end.getTime()&&d.end.getTime()>=a.end.getTime()){h=a.end}if(d.end.getTime()>a.start.getTime()&&d.start.getTime()<=a.start.getTime()){adjustedEnd=a.start}if(e.resizable==false||(d.end.getTime()<=a.end.getTime()&&d.start.getTime()>=a.start.getTime())){h=e.start;adjustedEnd=e.end;return false}});d.start=h||d.start;if(h&&f){d.end=new Date(h.getTime()+(e.end.getTime()-e.start.getTime()));i._adjustForEventCollisions(b,c,d,e)}else{d.end=adjustedEnd||d.end}if(d.start.getTime()>=d.end.getTime()){d.start=e.start;d.end=e.end}c.data('calEvent',d)},_addDraggableToCalEvent:function(d,e){var f=this.options;e.draggable({handle:'.wc-time',containment:'div.wc-time-slots',snap:'.wc-day-column-inner',snapMode:'inner',snapTolerance:f.timeslotHeight-1,revert:'invalid',opacity:0.5,grid:[e.outerWidth()+1,f.timeslotHeight],start:function(a,b){var c=b.draggable;f.eventDrag(d,c)}})},_addDroppableToWeekDay:function(p){var q=this;var r=this.options;p.droppable({accept:'.wc-cal-event',drop:function(a,b){var c=b.draggable;var d=Math.round(parseInt(b.position.top));var e=q._getEventDurationFromPositionedEventElement(p,c,d);var f=c.data('calEvent');var g=$.extend(true,{},f,{start:e.start,end:e.end});var h=r.showAsSeparateUsers&&r.users&&r.users.length;if(h){var i=p.data('wcUserId');var j=q._getEventUserId(f);var k=$(b.draggable.parents('.wc-day-column-inner').get(0)).data('wcUserId');if(!$.isArray(j)){j=[j]}if($.inArray(i,j)==-1){var l=$.inArray(k,j);j.splice(l,1);if($.inArray(i,j)==-1){j.push(i)}}g=q._setEventUserId(g,((j.length==1)?j[0]:j))}q._adjustForEventCollisions(p,c,g,f,true);var m=q.element.find('.wc-day-column-inner');r.eventDrop(g,f,c);var n=q._renderEvent(g,q._findWeekDayForEvent(g,m));c.hide();c.data('preventClick',true);var o=q._findWeekDayForEvent(c.data('calEvent'),q.element.find('.wc-time-slots .wc-day-column-inner'));if(o.data('startDate')!=p.data('startDate')){q._adjustOverlappingEvents(o)}q._adjustOverlappingEvents(p);setTimeout(function(){c.remove()},1000)}})},_addResizableToCalEvent:function(f,g,h){var i=this;var j=this.options;g.resizable({grid:j.timeslotHeight,containment:h,handles:'s',minHeight:j.timeslotHeight,stop:function(a,b){var c=b.element;var d=new Date(c.data('calEvent').start.getTime()+Math.max(1,Math.round(b.size.height/j.timeslotHeight))*j.millisPerTimeslot);if(i._needDSTdayShift(c.data('calEvent').start,d))d=i._getDSTdayShift(d,-1);var e=$.extend(true,{},f,{start:f.start,end:d});i._adjustForEventCollisions(h,c,e,f);i._refreshEventDetails(e,c);i._positionEvent(h,c);i._adjustOverlappingEvents(h);j.eventResize(e,f,c);c.data('preventClick',true);setTimeout(function(){c.removeData('preventClick')},500)}});$('.ui-resizable-handle',g).text('=')},_refreshEventDetails:function(a,b){b.find('.wc-time').html(this.options.eventHeader(a,this.element));b.find('.wc-title').html(this.options.eventBody(a,this.element));b.data('calEvent',a);this.options.eventRefresh(a,b)},_clearCalendar:function(){this.element.find('.wc-day-column-inner div').remove();this._clearFreeBusys()},_scrollToHour:function(c,d){var e=this;var f=this.options;var g=this.element.find('.wc-scrollable-grid');var h=c;if(e.options.businessHours.limitDisplay){if(c<=e.options.businessHours.start){h=0}else if(c>=e.options.businessHours.end){h=e.options.businessHours.end-e.options.businessHours.start-1}else{h=c-e.options.businessHours.start}}var i=this.element.find('.wc-grid-timeslot-header .wc-hour-header:eq('+h+')');g.animate({scrollTop:0},0,function(){var a=i.offset().top;var b=a-g.offset().top-i.outerHeight();if(d){g.animate({scrollTop:b},f.scrollToHourMillis)}else{g.animate({scrollTop:b},0)}})},_hourForIndex:function(a){if(a===0){return 12}else if(a<13){return a}else{return a-12}},_24HourForIndex:function(a){if(a===0){return'00:00'}else if(a<10){return'0'+a+':00'}else{return a+':00'}},_amOrPm:function(a){return a<12?'AM':'PM'},_isToday:function(a){var b=this._cloneDate(a);this._clearTime(b);var c=new Date();this._clearTime(c);return c.getTime()===b.getTime()},_cleanEvents:function(b){var c=this;$.each(b,function(i,a){c._cleanEvent(a)});return b},_cleanEvent:function(a){if(a.date){a.start=a.date}a.start=this._cleanDate(a.start);a.end=this._cleanDate(a.end);if(!a.end){a.end=this._addDays(this._cloneDate(a.start),1)}},_disableTextSelect:function(a){a.each(function(){if($.browser.mozilla){$(this).css('MozUserSelect','none')}else if($.browser.msie){$(this).bind('selectstart',function(){return false})}else{$(this).mousedown(function(){return false})}})},_dateFirstDayOfWeek:function(a){var b=this;var c=new Date(a.getFullYear(),a.getMonth(),a.getDate());var d=new Date(c);d.setDate(d.getDate()-b._getAdjustedDayIndex(c));return d},_dateLastDayOfWeek:function(a){var b=this;var c=new Date(a.getFullYear(),a.getMonth(),a.getDate());var d=new Date(c);var e=(b.options.daysToShow-1-b._getAdjustedDayIndex(c));d.setDate(d.getDate()+e);return d},_fixMinMaxDate:function(a){var b,maxDate;a=this._cleanDate(a);if(this.options.minDate){b=this._cleanDate(this.options.minDate);b=new Date(b.getFullYear(),b.getMonth(),b.getDate());if(a.getTime()<b.getTime()){this._trigger('reachedmindate',this.element,a)}a=this._cleanDate(Math.max(a.getTime(),b.getTime()))}if(this.options.maxDate){maxDate=this._cleanDate(this.options.maxDate);if(!this._startOnFirstDayOfWeek()){var c=maxDate.getDate()-this.options.daysToShow+1;maxDate=new Date(maxDate.getFullYear(),maxDate.getMonth(),c)}maxDate=new Date(maxDate.getFullYear(),maxDate.getMonth(),maxDate.getDate(),23,59,59,999);if(a.getTime()>maxDate.getTime()){this._trigger('reachedmaxdate',this.element,a)}a=this._cleanDate(Math.min(a.getTime(),maxDate.getTime()))}return a},_getAdjustedDayIndex:function(a){if(!this._startOnFirstDayOfWeek()){return 0}var b=new Date(a.getFullYear(),a.getMonth(),a.getDate());var c=b.getDay();var d=[0,1,2,3,4,5,6];this._rotate(d,this._firstDayOfWeek());return d[c]},_firstDayOfWeek:function(){if($.isFunction(this.options.firstDayOfWeek)){return this.options.firstDayOfWeek(this.element)}return this.options.firstDayOfWeek},_dateLastMilliOfWeek:function(a){var b=this._dateLastDayOfWeek(a);return new Date(b.getTime()+(v))},_clearTime:function(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d},_addDays:function(d,n,a){d.setDate(d.getDate()+n);if(a){return d}return this._clearTime(d)},_rotate:function(a,p){for(var l=a.length,p=(Math.abs(p)>=l&&(p%=l),p<0&&(p+=l),p),i,x;p;p=(Math.ceil(l/p)-1)*p-l+(l=p)){for(i=l;i>p;x=a[--i],a[i]=a[i-p],a[i-p]=x){}}return a},_cloneDate:function(d){return new Date(d.getTime())},_cleanDate:function(d){if(typeof d=='string'){if(!isNaN(parseFloat(d))&&isFinite()){return this._cleanDate(parseInt(d,10))}return Date.parse(d)||new Date(d)}if(typeof d=='number'){return new Date(d)}return d},_formatDate:function(a,b){var c='';for(var i=0;i<b.length;i++){var d=b.charAt(i);if(i!=0&&b.charAt(i-1)=='\\'){c+=d}else if(this._replaceChars[d]){c+=this._replaceChars[d](a,this._formatDate)}else if(d!='\\'){c+=d}}return c},_replaceChars:{shortMonths:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],longMonths:['January','February','March','April','May','June','July','August','September','October','November','December'],shortDays:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],longDays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],d:function(a){return(a.getDate()<10?'0':'')+a.getDate()},D:function(a){return this.shortDays[a.getDay()]},j:function(a){return a.getDate()},l:function(a){return this.longDays[a.getDay()]},N:function(a){return a.getDay()+1},S:function(a){return(a.getDate()%10==1&&a.getDate()!=11?'st':(a.getDate()%10==2&&a.getDate()!=12?'nd':(a.getDate()%10==3&&a.getDate()!=13?'rd':'th')))},w:function(a){return a.getDay()},z:function(a){var d=new Date(a.getFullYear(),0,1);return Math.ceil((a-d)/86400000)},W:function(a){var d=new Date(a.getFullYear(),0,1);return Math.ceil((((a-d)/86400000)+d.getDay()+1)/7)},F:function(a){return this.longMonths[a.getMonth()]},m:function(a){return(a.getMonth()<9?'0':'')+(a.getMonth()+1)},M:function(a){return this.shortMonths[a.getMonth()]},n:function(a){return a.getMonth()+1},t:function(a){var d=new Date();return new Date(d.getFullYear(),d.getMonth(),0).getDate()},L:function(a){var b=a.getFullYear();return(b%400==0||(b%100!=0&&b%4==0))},o:function(a){var d=new Date(a.valueOf());d.setDate(d.getDate()-((a.getDay()+6)%7)+3);return d.getFullYear()},Y:function(a){return a.getFullYear()},y:function(a){return(''+a.getFullYear()).substr(2)},a:function(a){return a.getHours()<12?'am':'pm'},A:function(a){return a.getHours()<12?'AM':'PM'},B:function(a){return Math.floor((((a.getUTCHours()+1)%24)+a.getUTCMinutes()/60+a.getUTCSeconds()/3600)*1000/24)},g:function(a){return a.getHours()%12||12},G:function(a){return a.getHours()},h:function(a){return((a.getHours()%12||12)<10?'0':'')+(a.getHours()%12||12)},H:function(a){return(a.getHours()<10?'0':'')+a.getHours()},i:function(a){return(a.getMinutes()<10?'0':'')+a.getMinutes()},s:function(a){return(a.getSeconds()<10?'0':'')+a.getSeconds()},u:function(a){var m=a.getMilliseconds();return(m<10?'00':(m<100?'0':''))+m},e:function(a){return'Not Yet Supported'},I:function(a){return'Not Yet Supported'},O:function(a){return(-a.getTimezoneOffset()<0?'-':'+')+(Math.abs(a.getTimezoneOffset()/60)<10?'0':'')+(Math.abs(a.getTimezoneOffset()/60))+'00'},P:function(a){return(-a.getTimezoneOffset()<0?'-':'+')+(Math.abs(a.getTimezoneOffset()/60)<10?'0':'')+(Math.abs(a.getTimezoneOffset()/60))+':00'},T:function(a){var m=a.getMonth();a.setMonth(0);var b=a.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,'$1');a.setMonth(m);return b},Z:function(a){return-a.getTimezoneOffset()*60},c:function(a,b){return b('Y-m-d\\TH:i:sP')},r:function(a){return a.toString()},U:function(a){return a.getTime()/1000}},getUserForId:function(a){return $.extend({},this.options.users[this._getUserIndexFromId(a)])},_getUserName:function(a){var b=this;var c=this.options;var d=c.users[a];if($.isFunction(c.getUserName)){return c.getUserName(d,a,b.element)}else{return d}},_getUserIdFromIndex:function(a){var b=this;var c=this.options;if($.isFunction(c.getUserId)){return c.getUserId(c.users[a],a,b.element)}return a},_getUserIndexFromId:function(a){var b=this;var c=this.options;for(var i=0;i<c.users.length;i++){if(b._getUserIdFromIndex(i)==a){return i}}return 0},_getEventUserId:function(a){var b=this;var c=this.options;if(c.showAsSeparateUsers&&c.users&&c.users.length){if($.isFunction(c.getEventUserId)){return c.getEventUserId(a,b.element)}return a.userId}return[]},_setEventUserId:function(a,b){var c=this;var d=this.options;if($.isFunction(d.setEventUserId)){return d.setEventUserId(b,a,c.element)}a.userId=b;return a},_getFreeBusyUserId:function(a){var b=this;var c=this.options;if($.isFunction(c.getFreeBusyUserId)){return c.getFreeBusyUserId(a.getOption(),b.element)}return a.getOption('userId')},_clearFreeBusys:function(){if(this.options.displayFreeBusys){var a=this,options=this.options,$freeBusyPlaceholders=a.element.find('.wc-grid-row-freebusy .wc-column-freebusy');$freeBusyPlaceholders.each(function(){$(this).data('wcFreeBusyManager',new A({start:a._cloneDate($(this).data('startDate')),end:a._cloneDate($(this).data('endDate')),defaultFreeBusy:options.defaultFreeBusy||{}}))});a.element.find('.wc-grid-row-freebusy .wc-freebusy').remove()}},_findWeekDaysForFreeBusy:function(b,c){var d,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,self=this,userList=self._getFreeBusyUserId(b);if(!$.isArray(userList)){userList=userList!='undefined'?[userList]:[]}if(!c){c=self.element.find('.wc-grid-row-freebusy .wc-column-freebusy')}c.each(function(){var a=$(this).data('wcFreeBusyManager'),has_overlap=a.isWithin(b.getStart())||a.isWithin(b.getEnd())||b.isWithin(a.getStart())||b.isWithin(a.getEnd()),userId=$(this).data('wcUserId');if(has_overlap&&(!showAsSeparatedUser||($.inArray(userId,userList)!=-1))){d=d?d.add($(this)):$(this)}});return d},_renderFreeBusys:function(e){if(this.options.displayFreeBusys){var f=this,$freeBusyPlaceholders=f.element.find('.wc-grid-row-freebusy .wc-column-freebusy'),freebusysToRender;if($.isArray(e)){freebusysToRender=f._cleanFreeBusys(e)}else if(e.freebusys){freebusysToRender=f._cleanFreeBusys(e.freebusys)}else{freebusysToRender=[]}$.each(freebusysToRender,function(b,c){var d=f._findWeekDaysForFreeBusy(c,$freeBusyPlaceholders);if(d){d.each(function(){var a=$(this).data('wcFreeBusyManager');a.insertFreeBusy(new z(c.getOption()));$(this).data('wcFreeBusyManager',a)})}});f._refreshFreeBusys($freeBusyPlaceholders)}},_refreshFreeBusys:function(b){if(this.options.displayFreeBusys&&b){var c=this,options=this.options,start=(options.businessHours.limitDisplay?options.businessHours.start:0),end=(options.businessHours.limitDisplay?options.businessHours.end:24);b.each(function(){var a=$(this);var s=c._cloneDate(a.data('startDate')),e=c._cloneDate(s);s.setHours(start);e.setHours(end);a.find('.wc-freebusy').remove();$.each(a.data('wcFreeBusyManager').getFreeBusys(s,e),function(){c._renderFreeBusy(this,a)})})}},_renderFreeBusy:function(a,b){if(this.options.displayFreeBusys){var c=this,options=this.options,freeBusyHtml='<div class="wc-freebusy"></div>';var d=$(freeBusyHtml);d.data('wcFreeBusy',new z(a.getOption()));this._positionFreeBusy(b,d);d=options.freeBusyRender(a.getOption(),d,c.element);if(d){d.appendTo(b)}}},_positionFreeBusy:function(a,b){var c=this.options;var d=b.data('wcFreeBusy');var e=a.height()/c.millisToDisplay;var f=c.businessHours.limitDisplay?c.businessHours.start:0;var g=d.getStart().getTime()-new Date(d.getStart().getFullYear(),d.getStart().getMonth(),d.getStart().getDate(),f).getTime();var h=d.getEnd().getTime()-d.getStart().getTime();var i=e*g;var j=e*h;b.css({top:i,height:j})},_cleanFreeBusys:function(b){var c=this,freeBusyToReturn=[];if(!$.isArray(b)){var b=[b]}$.each(b,function(i,a){freeBusyToReturn.push(new z(c._cleanFreeBusy(a)))});return freeBusyToReturn},_cleanFreeBusy:function(a){if(a.date){a.start=a.date}a.start=this._cleanDate(a.start);a.end=this._cleanDate(a.end);return a},getFreeBusyManagersFor:function(a,b){var c={start:a,end:a};this._setEventUserId(c,b);return this.getFreeBusyManagerForEvent(c)},getFreeBusyManagerForEvent:function(b){var c=this,options=this.options,freeBusyManager;if(options.displayFreeBusys){var d=c.element.find('.wc-grid-row-freebusy .wc-column-freebusy'),freeBusy=new z({start:b.start,end:b.end}),showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,userId=showAsSeparatedUser?c._getEventUserId(b):null;if(!$.isArray(userId)){userId=[userId]}d.each(function(){var a=$(this).data('wcFreeBusyManager'),has_overlap=a.isWithin(freeBusy.getEnd())||a.isWithin(freeBusy.getEnd())||freeBusy.isWithin(a.getStart())||freeBusy.isWithin(a.getEnd());if(has_overlap&&(!showAsSeparatedUser||$.inArray($(this).data('wcUserId'),userId)!=-1)){freeBusyManager=$(this).data('wcFreeBusyManager');return false}})}return freeBusyManager},updateFreeBusy:function(g){var h=this,options=this.options;if(options.displayFreeBusys){var i,$freeBusyPlaceHoders=h.element.find('.wc-grid-row-freebusy .wc-column-freebusy'),_freeBusys=h._cleanFreeBusys(g);$.each(_freeBusys,function(d,e){var f=h._findWeekDaysForFreeBusy(e,$freeBusyPlaceHoders);if(f.length){f.each(function(a,b){var c=$(b).data('wcFreeBusyManager');c.insertFreeBusy(e);$(b).data('wcFreeBusyManager',c)});i=i?i.add(f):f}});h._refreshFreeBusys(i)}},_startOnFirstDayOfWeek:function(){return jQuery.isFunction(this.options.startOnFirstDayOfWeek)?this.options.startOnFirstDayOfWeek(this.element):this.options.startOnFirstDayOfWeek},_getCurrentScrollHour:function(){var a=this;var b=this.options;var c=this.element.find('.wc-scrollable-grid');var d=c.scrollTop();if(a.options.businessHours.limitDisplay){d=d+b.businessHours.start*b.timeslotHeight*b.timeslotsPerHour}return Math.round(d/(b.timeslotHeight*b.timeslotsPerHour))+1},_getJsonOptions:function(){if($.isFunction(this.options.jsonOptions)){return $.extend({},this.options.jsonOptions(this.element))}if($.isPlainObject(this.options.jsonOptions)){return $.extend({},this.options.jsonOptions)}return{}},_getHeaderDate:function(a){var b=this.options;if(b.getHeaderDate&&$.isFunction(b.getHeaderDate)){return b.getHeaderDate(a,this.element)}var c=b.useShortDayNames?b.shortDays[a.getDay()]:b.longDays[a.getDay()];return c+(b.headerSeparator)+this._formatDate(a,b.dateFormat)},_getDSTdayShift:function(a,b){var c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0);var d=c.getTimezoneOffset();var e=a.getTimezoneOffset();if(d==e)return a;b=b?b:1;return new Date(a.getTime()-b*(d>e?-1:1)*(Math.max(d,e)-Math.min(d,e))*60000)},_needDSTdayShift:function(a,b){return a.getTimezoneOffset()!=b.getTimezoneOffset()}}})());$.extend($.ui.weekCalendar,{version:'2.0-dev',updateLayoutOptions:{startOnFirstDayOfWeek:true,firstDayOfWeek:true,daysToShow:true,displayOddEven:true,timeFormat:true,dateFormat:true,use24Hour:true,useShortDayNames:true,businessHours:true,timeslotHeight:true,timeslotsPerHour:true,buttonText:true,height:true,shortMonths:true,longMonths:true,shortDays:true,longDays:true,textSize:true,users:true,showAsSeparateUsers:true,displayFreeBusys:true}});var v=86400000;var w=v*7;var y={getStart:function(){return this.getOption('start')},getEnd:function(){return this.getOption('end')},getOption:function(){if(!arguments.length){return this.options}if(typeof(this.options[arguments[0]])!=='undefined'){return this.options[arguments[0]]}else if(typeof(arguments[1])!=='undefined'){return arguments[1]}return null},setOption:function(a,b){if(arguments.length==1){$.extend(this.options,arguments[0]);return this}this.options[a]=b;return this},isWithin:function(a){return Math.floor(a.getTime()/1000)>=Math.floor(this.getStart().getTime()/1000)&&Math.floor(a.getTime()/1000)<=Math.floor(this.getEnd().getTime()/1000)},isValid:function(){return this.getStart().getTime()<this.getEnd().getTime()}};var z=function(a){this.options=$.extend({},a||{})};$.extend(z.prototype,y);var A=function(a){this.options=$.extend({defaultFreeBusy:{}},a||{});this.freeBusys=[];this.freeBusys.push(new z($.extend({start:this.getStart(),end:this.getEnd()},this.options.defaultFreeBusy)))};$.extend(A.prototype,y,{getFreeBusys:function(){switch(arguments.length){case 0:return this.freeBusys;case 1:var b=[];var c=arguments[0];if(!this.isWithin(c)){return b}$.each(this.freeBusys,function(){if(this.isWithin(c)){b.push(this)}if(Math.floor(this.getEnd().getTime()/1000)>Math.floor(c.getTime()/1000)){return false}});return b;default:var b=[];var c=arguments[0],end=arguments[1];var d=new z({start:c,end:end});if(end.getTime()<c.getTime()||this.getStart().getTime()>end.getTime()||this.getEnd().getTime()<c.getTime()){return b}$.each(this.freeBusys,function(){if(this.getStart().getTime()>=end.getTime()){return false}if(d.isWithin(this.getStart())&&d.isWithin(this.getEnd())){b.push(this)}else if(this.isWithin(d.getStart())&&this.isWithin(d.getEnd())){var a=new z(this.getOption());a.setOption('end',d.getEnd());a.setOption('start',d.getStart());b.push(a)}else if(this.isWithin(d.getStart())&&this.getStart().getTime()<c.getTime()){var a=new z(this.getOption());a.setOption('start',d.getStart());b.push(a)}else if(this.isWithin(d.getEnd())&&this.getEnd().getTime()>end.getTime()){var a=new z(this.getOption());a.setOption('end',d.getEnd());b.push(a)}});return b}},insertFreeBusy:function(f){var f=new z(f.getOption());if(f.getStart().getTime()<this.getStart().getTime()){f.setOption('start',this.getStart())}if(f.getEnd().getTime()>this.getEnd().getTime()){f.setOption('end',this.getEnd())}var g=f.getStart(),end=f.getEnd(),startIndex=0,endIndex=this.freeBusys.length-1,newFreeBusys=[];var h=function(a){if(a.isValid())newFreeBusys.push(a)};$.each(this.freeBusys,function(a){var b=this;if(b.isWithin(g)&&b.isWithin(end)){startIndex=a;endIndex=a;if(g.getTime()==b.getStart().getTime()&&end.getTime()==b.getEnd().getTime()){var c=new z(f.getOption());h(c)}else if(g.getTime()==b.getStart().getTime()){var c=new z(f.getOption());var d=new z(b.getOption());d.setOption('start',end);h(c);h(d)}else if(end.getTime()==b.getEnd().getTime()){var c=new z(b.getOption());c.setOption('end',g);var d=new z(f.getOption());h(c);h(d)}else{var c=new z(b.getOption());var d=new z(f.getOption());var e=new z(b.getOption());c.setOption('end',g);e.setOption('start',end);h(c);h(d);h(e)}return false}else if(b.isWithin(g)&&b.getEnd().getTime()!=g.getTime()){if(b.getStart().getTime()!=g.getTime()){var c=new z(b.getOption());c.setOption('end',g);h(c)}startIndex=a}else if(b.isWithin(end)&&b.getStart().getTime()!=end.getTime()){h(new z(f.getOption()));if(end.getTime()<b.getEnd().getTime()){var c=new z(b.getOption());c.setOption('start',end);h(c)}endIndex=a;return false}});var i=this.freeBusys;this.freeBusys=[];if(startIndex){this.freeBusys=this.freeBusys.concat(i.slice(0,startIndex))}this.freeBusys=this.freeBusys.concat(newFreeBusys);if(endIndex<i.length){this.freeBusys=this.freeBusys.concat(i.slice(endIndex+1))}return this}})})(jQuery);